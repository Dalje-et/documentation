{{- $isLocalServer := .Site.IsServer -}}
{{- $jsMain := "scripts/main.js" -}}
{{- $defines := dict "CI_COMMIT_SHORT_SHA" (getenv "CI_COMMIT_SHORT_SHA" | default `""`) "process.env.NODE_ENV" `"development"` -}}
{{- $devOpts := dict "defines" $defines "targetPath" $jsMain "sourceMap" "inline" -}}
{{- $prodOpts := dict "defines" $defines "targetPath" $jsMain "sourceMap" "inline" "minify" true -}}
{{- $options := cond $isLocalServer $devOpts $prodOpts -}}

{{- $js := resources.Get $jsMain | js.Build $options -}}

<script type="text/javascript" src="{{ $js.Permalink }}"></script>
