{{ $isLocalServer := .Site.IsServer }}
{{ $jsMain := "scripts/main.js" }}
{{ $outputJS := "" }}
{{ $options := "" }}
{{ $defines := dict "CI_COMMIT_SHORT_SHA" (getenv "CI_COMMIT_SHORT_SHA" | default `""`) "process.env.NODE_ENV" `"development"` "process.env.RESET_APP_DATA_TIMER" `10` }}
{{ $jQuery := resources.Get "scripts/jquery.min.js" }}

{{ if $isLocalServer }}
  {{ $options = dict "defines" $defines "targetPath" $jsMain "sourceMap" "inline" }}
  {{ $outputJS = resources.Get $jsMain | js.Build $options }}
{{ else }}
  {{ $options = dict "defines" $defines "targetPath" $jsMain "sourceMap" "inline" "minify" true }}
  {{ $outputJS = resources.Get $jsMain | js.Build $options | resources.Fingerprint "sha512" }}
{{ end }}

{{/* The docsearch.js lib requires this for some reason */}}
<script>global = globalThis;</script>

<script src="{{ $jQuery.Permalink }}"></script>

{{ if $isLocalServer }}
  <script type="text/javascript" src="{{ $outputJS.Permalink }}" defer></script>
{{ else }}
  <script type="text/javascript" src="{{ $outputJS.Permalink }}" integrity="{{ $outputJS.Data.Integrity }}" defer></script>
{{ end }}

